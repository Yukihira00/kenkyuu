<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>HEXACO性格診断</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f7f9fc;
            color: #333;
            caret-color: transparent;
        }
        form {
            max-width: 1200px;
            min-width: 320px;
            width: 90vw;
            margin: 2rem auto;
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        h1 { text-align: center; }
        .question-item { margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #eee; }
        .question-item:last-of-type { border-bottom: none; }
        .question-item p { font-size: 1.1em; font-weight: 500; text-align: center; margin-bottom: 1.5rem; }
        .options-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1vw;
        }
        .option-label-text {
            flex: 0 0 120px;
            text-align: center;
            color: #555;
            white-space: nowrap;
        }
        .options {
            display: flex;
            flex-grow: 1;
            justify-content: center;
            gap: 0.7vw;
            min-width: 220px;
            align-items: center;
        }
        .option {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1 1 0;
            justify-content: center;
        }
        input[type="radio"] { display: none; }
        .option label {
            display: block;
            border: 2.5px solid #ccc;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(.4,2,.6,1), border-color 0.2s, background-color 0.2s;
            margin: 0 auto;
            background: #fff;
        }
        .circle-1, .circle-5 {
            width: 3.5vw;
            height: 3.5vw;
            min-width: 38px;
            min-height: 38px;
            max-width: 60px;
            max-height: 60px;
        }
        .circle-2, .circle-4 {
            width: 2.7vw;
            height: 2.7vw;
            min-width: 30px;
            min-height: 30px;
            max-width: 48px;
            max-height: 48px;
        }
        .circle-3 {
            width: 2vw;
            height: 2vw;
            min-width: 22px;
            min-height: 22px;
            max-width: 36px;
            max-height: 36px;
        }
        .circle-1 { border-color: #33A474; }
        .circle-2 { border-color: #33A474; }
        .circle-3 { border-color: #9B9EAB; }
        .circle-4 { border-color: #89619B; }
        .circle-5 { border-color: #89619B; }
        input[type="radio"]:checked + .circle-1,
        .option label.circle-1:hover {
            background-color: #33A474;
            border-color: #33A474;
        }
        input[type="radio"]:checked + .circle-2,
        .option label.circle-2:hover {
            background-color: #33A474;
            border-color: #33A474;
        }
        input[type="radio"]:checked + .circle-3,
        .option label.circle-3:hover {
            background-color: #9B9EAB;
            border-color: #9B9EAB;
        }
        input[type="radio"]:checked + .circle-4,
        .option label.circle-4:hover {
            background-color: #89619B;
            border-color: #89619B;
        }
        input[type="radio"]:checked + .circle-5,
        .option label.circle-5:hover {
            background-color: #89619B;
            border-color: #89619B;
        }
        .option label:hover {
            transform: scale(1.15);
        }
        input[type="radio"]:checked + label {
            transform: scale(1.1);
        }
        .navigation-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            gap: 8vw;
        }
        .mono-btn {
            padding: 0.9em 2.2em;
            border: none;
            border-radius: 2em;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            background: #7fd7f8;
            color: #fff;
            box-shadow: 0 2px 8px rgba(127,215,248,0.10);
            transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
            letter-spacing: 0.05em;
            min-width: 160px;
        }
        #nextBtn.mono-btn { background: #ff7eb9; }
        .mono-btn:disabled {
            background: #e0e0e0;
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
        }
        .mono-btn:hover:not(:disabled) {
            background: #2bb3d8;
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 4px 16px rgba(127,215,248,0.15);
        }
        #nextBtn.mono-btn:hover:not(:disabled) {
            background: #e055a2;
            box-shadow: 0 4px 16px rgba(255,126,185,0.15);
        }
        .error {
            display: none;
            color: #e055a2;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            margin: 1.5em auto 0 auto;
            background: none;
            box-shadow: none;
            border-radius: 0;
            padding: 0;
            animation: fadeIn 0.5s;
        }
        .error.show {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px);}
            to { opacity: 1; transform: translateY(0);}
        }
        @media (max-width: 700px) {
            form { padding: 2vw 2vw; }
            .option-label-text { font-size: 0.85em; min-width: 60px; max-width: 100px; }
            .options { gap: 0.3vw; }
            .navigation-buttons { gap: 2vw; }
            .mono-btn { min-width: 100px; font-size: 1em; }
        }
    </style>
</head>
<body>
    <h1>HEXACO性格診断</h1>
    <form id="quizForm" action="/submit" method="post" autocomplete="off">
        {% set page_size = 10 %}
        {% for q in questions %}
            {% if loop.index0 % page_size == 0 %}
                {% if not loop.first %}</div>{% endif %}
                <div class="question-page" id="page-{{ (loop.index0 // page_size) + 1 }}" {% if not loop.first %}style="display: none;"{% endif %}>
            {% endif %}
            <div class="question-item">
                <p><strong>質問{{ q.id }}:</strong> {{ q.text }}</p>
                <div class="options-container">
                    <span class="option-label-text">まったく当てはまらない</span>
                    <div class="options">
                        <div class="option">
                            <input type="radio" name="q{{ q.id }}" id="q{{ q.id }}-1" value="1" required>
                            <label for="q{{ q.id }}-1" class="circle-1"></label>
                        </div>
                        <div class="option">
                            <input type="radio" name="q{{ q.id }}" id="q{{ q.id }}-2" value="2">
                            <label for="q{{ q.id }}-2" class="circle-2"></label>
                        </div>
                        <div class="option">
                            <input type="radio" name="q{{ q.id }}" id="q{{ q.id }}-3" value="3">
                            <label for="q{{ q.id }}-3" class="circle-3"></label>
                        </div>
                        <div class="option">
                            <input type="radio" name="q{{ q.id }}" id="q{{ q.id }}-4" value="4">
                            <label for="q{{ q.id }}-4" class="circle-4"></label>
                        </div>
                        <div class="option">
                            <input type="radio" name="q{{ q.id }}" id="q{{ q.id }}-5" value="5">
                            <label for="q{{ q.id }}-5" class="circle-5"></label>
                        </div>
                    </div>
                    <span class="option-label-text">すごく当てはまる</span>
                </div>
            </div>
        {% endfor %}
        </div> {# 最後のページのdivを閉じる #}

        <div class="navigation-buttons">
            <button type="button" id="prevBtn" class="mono-btn">前のページへ</button>
            <button type="button" id="nextBtn" class="mono-btn">次のページへ</button>
            <button type="submit" id="submitBtn" class="mono-btn" style="display: none;">診断結果を送信</button>
        </div>
        <div id="warning" class="error"></div>
        {% if error %}
            <p class="error show">{{ error }}</p>
        {% endif %}
    </form>
    <script>
        let currentPage = 1;
        const totalPages = Math.ceil(Number("{{ questions|length }}") / 10);
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const warning = document.getElementById('warning');

        function showPage(pageNumber) {
            document.querySelectorAll('.question-page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(`page-${pageNumber}`).style.display = 'block';
            window.scrollTo({top: 0, behavior: "smooth"});
            if (pageNumber === 1) {
                prevBtn.style.visibility = 'hidden';
            } else {
                prevBtn.style.visibility = 'visible';
            }
        }

        function validateCurrentPageAndFocus() {
            const currentPageDiv = document.getElementById(`page-${currentPage}`);
            const questionsOnPage = currentPageDiv.querySelectorAll('.question-item');
            for (let i = 0; i < questionsOnPage.length; i++) {
                if (!questionsOnPage[i].querySelector('input[type="radio"]:checked')) {
                    // 未回答の質問のラジオボタンにフォーカス
                    const firstRadio = questionsOnPage[i].querySelector('input[type="radio"]');
                    if (firstRadio) firstRadio.focus();
                    // スクロールして中央に
                    questionsOnPage[i].scrollIntoView({behavior: "smooth", block: "center"});
                    // シンプルな警告
                    warning.textContent = '未回答の質問があります。すべて回答してください。';
                    warning.classList.add('show');
                    return false;
                }
            }
            warning.classList.remove('show');
            return true;
        }

        function updateButtons() {
            if (currentPage === 1) {
                prevBtn.style.visibility = 'hidden';
            } else {
                prevBtn.style.visibility = 'visible';
            }
            if (currentPage === totalPages) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
            }
        }

        nextBtn.addEventListener('click', () => {
            if (validateCurrentPageAndFocus()) {
                if (currentPage < totalPages) {
                    currentPage++;
                    showPage(currentPage);
                    updateButtons();
                }
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
                updateButtons();
            }
        });

        // 初期表示
        showPage(currentPage);
        updateButtons();
    </script>
</body>
</html>